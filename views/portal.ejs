<!DOCTYPE html>
<html lang="sl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WISFI</title>
    <link rel="stylesheet" href="/wisfi/public/main.css">
</head>

<body>
    <div class="container">
        <header>
            <nav>
                <div class="logo">
                    <span class="logo-icon">üçé</span>
                    <span>WISFI - Kaj je v hrani</span>
                </div>
                <div class="nav-links">
                    <a href="/wisfi/public/kontakt.html">Zemljevid</a>
                    <a href="/wisfi/public/kontakt.html">Kontakt</a>
                    <a href="/wisfi/public/kontakt.html">Api</a>
                    <a href="/wisfi/nastavitve">Nastavitve</a>
                </div>
            </nav>
        </header>



        <main>
            <section class="search-section">
                <h1 class="search-title">Poi≈°ƒçite izdelek</h1>
                <p class="search-subtitle">Poi≈°ƒçite izdelek po va≈°i ≈æelji, in ugotovite kaj vsebuje</p>

                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Vnesite ime izdelka..." id="searchInput">
                    <button class="search-button" onclick="searchProduct()">üîç</button>
                </div>

            </section>

            <section id="new-show" class="featured-product"
                style="max-width: 700px; margin: 0 auto 3rem auto; display: none;">
                <div class="product-card" style="display: flex; flex-direction: row; min-width: 0;">
                    <div id="new-show-img" class=""
                        style="width: 220px; height: 220px; font-size: 6rem; flex-shrink: 0; align-items: center; justify-content: center; display: flex;">
                    </div>
                    <div class="product-info" style="flex: 1; padding: 2rem;">
                        <div id="new-show-name" class="product-name" style="font-size: 2rem;"></div>
                        <div id="new-show-name2" class="product-brand"
                            style="font-size: 1.1rem; margin-bottom: 1.2rem;"></div>
                        <div id="new-show-name3" class="product-ingredients" style="font-size: 1.1rem;">
                        </div>

                    </div>
                </div>
            </section>

            <section class="recent-section">
                <h2 class="section-title">Nedavno iskani izdelki</h2>













                <div id="carousel-wrapper" class="carousel-wrapper">
                    <div class="carousel" id="carousel">
                        <div class="product-card" onclick="viewProduct('Nutella')">
                            <div class="product-image">üç´</div>
                            <div class="product-info">
                                <div class="product-name">Nutella</div>
                                <div class="product-brand">Ferrero</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: sladkor, palmovo olje, le≈°niki, kakav v prahu, posneto mleko v
                                    prahu
                                </div>
                            </div>
                        </div>

                        <div class="product-card" onclick="viewProduct('Coca Cola')">
                            <div class="product-image">ü•§</div>
                            <div class="product-info">
                                <div class="product-name">Coca Cola</div>
                                <div class="product-brand">The Coca-Cola Company</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: gazirana voda, sladkor, barvilo karamel, kislina, naravne
                                    arome, kofein
                                </div>
                            </div>
                        </div>

                        <div class="product-card" onclick="viewProduct('Milka ƒçokolada')">
                            <div class="product-image">üç´</div>
                            <div class="product-info">
                                <div class="product-name">Milka ƒçokolada</div>
                                <div class="product-brand">Mondelez</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: sladkor, kakavovo maslo, mleko v prahu, kakavova masa, laktoza
                                </div>
                            </div>
                        </div>

                        <div class="product-card" onclick="viewProduct('Activia jogurt')">
                            <div class="product-image">ü•õ</div>
                            <div class="product-info">
                                <div class="product-name">Activia jogurt</div>
                                <div class="product-brand">Danone</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: mleko, sladkor, jogurtove kulture, naravne arome, sadni
                                    pripravek
                                </div>
                            </div>
                        </div>

                        <div class="product-card" onclick="viewProduct('Pringles')">
                            <div class="product-image">ü•î</div>
                            <div class="product-info">
                                <div class="product-name">Pringles Original</div>
                                <div class="product-brand">Kellogg's</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: krompirjeva moka, rastlinska olja, p≈°eniƒçna moka, sol,
                                    emulgatorji
                                </div>
                            </div>
                        </div>

                        <div class="product-card" onclick="viewProduct('Red Bull')">
                            <div class="product-image">‚ö°</div>
                            <div class="product-info">
                                <div class="product-name">Red Bull</div>
                                <div class="product-brand">Red Bull GmbH</div>
                                <div class="product-ingredients">
                                    Glavne sestavine: voda, saharoza, glukoza, kislina, taurin, kofein, vitamini B
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-dots">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>

                </div>
    </div>
    </section>
    </main>

    <footer>
        <p>WISFI - Narejeno za konƒçno projektno nalogo na Fakulteta za elektrotehniko, raƒçunalni≈°tvo in informatiko.
        </p>
    </footer>
    </div>

    <script>

        let products = JSON.parse(`<%- JSON.stringify(products || []) %>`)
        let arrProducts = [];
        if (products && products.length > 0) {
            for (let i = 0; i < products.length; i++) {
                arrProducts.push(products[i].qrcode);
            }
        }

        arrProducts.forEach((product, index) => {
            console.log('Izdelek:', product);
            fetch(`/wisfi/public/data/${product}.json`)
                .then(response => response.json())
                .then(data => {
                    console.log('Podrobnosti izdelka:', data);

                    const carouselWrapper = document.getElementById('carousel-wrapper');
                    const carousel = document.getElementById('carousel');
                    if (carousel) {
                        // Clear existing cards
                        carousel.innerHTML = '';
                        // Add new product card
                        const card = document.createElement('div');
                        card.className = 'product-card';
                        card.onclick = () => viewProduct(data.name || '');
                        card.innerHTML = `
                        <div class="product-image">${data.emoji || 'üõí'}</div>
                        <div class="product-info">
                            <div class="product-name">${data.name || 'Neznan izdelek'}</div>
                            <div class="product-brand">${data.brand || 'Neznana blagovna znamka'}</div>
                            <div class="product-ingredients">
                                Glavne sestavine: ${data.ingredients ? data.ingredients.join(', ') : 'Ni podatkov'}
                            </div>
                        </div>
                    `;
                        carousel.appendChild(card);
                    }

                })
                .catch(err => {
                    console.error('Napaka pri pridobivanju podrobnosti izdelka:', err);
                });
        });






        let currentSlide = 0;
        const carousel = document.getElementById('carousel');
        const dots = document.querySelectorAll('.dot');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        let cardsPerView = window.innerWidth <= 768 ? 1 : 3;
        const totalCards = 6;
        let maxSlides = Math.max(0, totalCards - cardsPerView);







        function slideCarousel(direction) {
            const newSlide = currentSlide + direction;

            if (newSlide < 0) {
                currentSlide = 0;
            } else if (newSlide > maxSlides) {
                currentSlide = maxSlides;
            } else {
                currentSlide = newSlide;
            }


        }

        function goToSlide(slideIndex) {
            currentSlide = slideIndex * cardsPerView;
            if (currentSlide > maxSlides) {
                currentSlide = maxSlides;
            }
        }

        function searchProduct() {
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm.trim()) {
                fetch(`/wisfi/getItems?name=${encodeURIComponent(searchTerm)}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Rezultati iskanja:', data.result);
                        if (data.result && data.result.length > 0) {
                            const fileName = data.result.replace(/\s+/g, '');
                            fetch(`/wisfi/public/data/${fileName}.json`)
                                .then(res => res.json())
                                .then(details => {
                                    console.log(details);
                                    document.getElementById('new-show').style.display = 'block';
                                    if (details.imageSrc) {
                                        document.getElementById('new-show-img').innerHTML = `<img src="${details.imageSrc}" alt="${details.name || ''}" style="width:100%;height:100%;object-fit:contain;">`;
                                    }
                                    document.getElementById('new-show-name').textContent = details.name || 'Neznan izdelek';
                                    document.getElementById('new-show-name2').textContent = details.price || 'Neznana blagovna znamka';

                                })
                                .catch(err => {
                                    alert('Napaka pri pridobivanju podrobnosti izdelka.');
                                    console.error(err);
                                });
                        } else {
                            alert('Izdelek ni bil najden.');
                        }
                    })
                    .catch(error => {
                        console.error('Napaka pri iskanju:', error);
                    });
            }
        }

        function searchSuggestion(term) {
            document.getElementById('searchInput').value = term;
            searchProduct();
        }

        function viewProduct(productName) {
            alert(`Prikaz podrobnosti za: ${productName}`);
        }

        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                searchProduct();
            }
        });

        window.addEventListener('resize', () => {
            cardsPerView = window.innerWidth <= 768 ? 1 : 3;
            maxSlides = Math.max(0, totalCards - cardsPerView);
            currentSlide = Math.min(currentSlide, maxSlides);
        });

        setTimeout(() => {
        }, 100);
    </script>
</body>

</html>